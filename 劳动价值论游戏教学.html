<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <title>åŠ³åŠ¨ä»·å€¼è®ºæ•™å­¦æ¸¸æˆ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(90deg, #2c3e50 0%, #4ca1af 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .content {
      padding: 30px;
    }
    
    .section {
      margin-bottom: 40px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: #4ca1af;
    }
    
    .section-title {
      font-size: 1.8rem;
      color: #2c3e50;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e1e8ed;
      display: flex;
      align-items: center;
    }
    
    .section-title::before {
      content: "";
      display: inline-block;
      width: 12px;
      height: 12px;
      background: #4ca1af;
      border-radius: 50%;
      margin-right: 15px;
    }
    
    .point {
      margin-bottom: 25px;
      padding-left: 25px;
      position: relative;
    }
    
    .point::before {
      content: "â€¢";
      position: absolute;
      left: 0;
      color: #4ca1af;
      font-size: 1.5rem;
    }
    
    .point-title {
      font-size: 1.3rem;
      color: #2c3e50;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .point-content {
      color: #555;
      line-height: 1.8;
      margin-bottom: 10px;
    }
    
    .highlight {
      background: rgba(76, 161, 175, 0.1);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-left: 3px solid #4ca1af;
    }
    
    .concept-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }
    
    .concept-card {
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border: 1px solid #e1e8ed;
    }
    
    .concept-card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      transform: translateY(-5px);
    }
    
    .concept-title {
      font-size: 1.3rem;
      color: #2c3e50;
      margin-bottom: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .concept-title::before {
      content: "";
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #4ca1af;
      border-radius: 50%;
      margin-right: 12px;
    }
    
    .logic-chain {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 30px;
    }
    
    .chain-step {
      background: white;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 25px;
      width: 90%;
      position: relative;
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid #e1e8ed;
    }
    
    .chain-step:hover {
      background: #f0f9fb;
      transform: scale(1.02);
    }
    
    .chain-step::after {
      content: "â†“";
      display: block;
      font-size: 1.8rem;
      color: #4ca1af;
      margin-top: 15px;
      font-weight: bold;
    }
    
    .chain-step:last-child::after {
      display: none;
    }
    
    .step-number {
      position: absolute;
      top: -12px;
      left: -12px;
      width: 30px;
      height: 30px;
      background: #4ca1af;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    .theorist {
      display: flex;
      align-items: center;
      margin-top: 20px;
      padding: 15px;
      background: rgba(44, 62, 80, 0.05);
      border-radius: 8px;
    }
    
    .theorist img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 20px;
      border: 3px solid #4ca1af;
    }
    
    .theorist-info {
      flex: 1;
    }
    
    .theorist-name {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 5px;
    }
    
    .theorist-contribution {
      color: #555;
    }
    
    footer {
      text-align: center;
      padding: 25px;
      background: #2c3e50;
      color: white;
      font-size: 0.95rem;
    }
    
    @media (max-width: 768px) {
      .concept-grid {
        grid-template-columns: 1fr;
      }
      
      .chain-step {
        width: 100%;
      }

      h5 {
        font-size: 2rem; 
      }
      
      .section-title {
        font-size: 1.5rem;
      }
    }

    :root {
      --bg: #f5f8fa;
      --card: #ffffff;
      --accent: #2b8cff;
      --accent-dark: #1a6fd9;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --text: #333;
      --text-light: #666;
      --border: #e1e8ed;
      --shadow: rgba(10, 20, 40, 0.08);
    }
    
    * {
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    body {
      font-family: "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      color: var(--text);
      line-height: 1.6;
    }
    
    .wrap {
      max-width: 1100px;
      margin: 18px auto;
      padding: 12px;
    }
    
    h1, h2, h3, h4 {
      margin: 0 0 10px 0;
      font-weight: 600;
    }
    
    h1 {
      font-size: 24px;
      color: var(--text);
    }
    
    .subtitle {
      color: var(--text);
      margin-bottom: 16px;
      font-size: 15px;
    }
    
    .card {
      background: var(--card);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 8px 24px var(--shadow);
      margin-bottom: 20px;
      text-align: center;
      position: relative;
    }
    
    .return-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 10;
    }
    
    .return-btn:hover {
      background: white;
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .mode-select {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .mode-btn {
      width: 220px;
      padding: 25px;
      border-radius: 12px;
      background: #f8fafc;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .mode-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(43, 140, 255, 0.15);
      border-color: var(--accent);
      background: #f0f7ff;
    }
    
    .mode-btn h3 {
      margin-top: 0;
      color: var(--accent);
    }
    
    .mode-btn p {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .roles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .role {
      padding: 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fbfdff;
      cursor: pointer;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    
    .role::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--accent);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .role:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(43, 140, 255, 0.15);
      border-color: rgba(43, 140, 255, 0.35);
    }
    
    .role:hover::before {
      opacity: 1;
    }
    
    .role.selected {
      box-shadow: 0 8px 20px rgba(43, 140, 255, 0.2);
      border-color: var(--accent);
      background: #f0f7ff;
    }
    
    .role.selected::before {
      opacity: 1;
    }
    
    .role h3 {
      margin: 0 0 8px 0;
      font-size: 17px;
      color: var(--text);
    }
    
    .role p {
      margin: 0;
      color: var(--text-light);
      font-size: 14px;
      flex-grow: 1;
    }
    
    .meta {
      font-size: 13px;
      color: var(--text-light);
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
    }
    
    .controls {
      margin-top: 16px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    button:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.ghost {
      background: transparent;
      color: #285a33;
      border: 3px solid #184d72;
      font-weight: 800;
    }
    
    button.ghost:hover {
      background: #f5f9ff;
      border-color: #04060a;
      color: var(--accent);
    }
    
    .small {
      position: absolute;
      top: 15px;
      right: 15px;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      z-index: 10;
    }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 20px;
      margin-top: 20px;
    }
    
    .stat {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed var(--border);
    }
    
    .stat-value {
      font-weight: 600;
      color: var(--accent);
    }
    
    .muted {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .log {
      height: 200px;
      overflow: auto;
      background: #fafafa;
      border: 1px solid var(--border);
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .log-entry {
      padding: 6px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .log-entry:last-child {
      border-bottom: none;
    }
    
    .product-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-bottom: 10px;
      background: #fff;
    }
    
    .footer {
      margin-top: 16px;
      text-align: center;
      color: var(--text-light);
      font-size: 14px;
      padding: 10px 0;
    }
    
    .topbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .label {
      font-weight: 600;
      color: var(--text);
    }
    
    .explain {
      background: #fff8e6;
      border: 1px solid #ffe1a8;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 14px;
    }
    
    .explain h4 {
      margin-top: 0;
      color: #d48806;
    }
    
    .progress-bar {
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.5s;
    }
    
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      margin-left: 8px;
    }
    
    .badge-primary {
      background: rgba(43, 140, 255, 0.15);
      color: var(--accent);
    }
    
    .badge-success {
      background: rgba(40, 167, 69, 0.15);
      color: var(--success);
    }
    
    .badge-warning {
      background: rgba(255, 193, 7, 0.15);
      color: var(--warning);
    }
    
    .badge-danger {
      background: rgba(220, 53, 69, 0.15);
      color: var(--danger);
    }
    
    .section-title {
      display: flex;
      align-items: center;
      margin: 20px 0 15px;
      font-size: 18px;
      color: var(--text);
    }
    
    .section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
      margin-left: 15px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .stat-card {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .stat-card .value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin: 5px 0;
    }
    
    .stat-card .label {
      font-size: 14px;
      color: var(--text-light);
    }
    
    .highlight {
      background: rgba(43, 140, 255, 0.1);
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .demo-result {
      background: #f0f9ff;
      border-left: 4px solid var(--accent);
      padding: 10px 15px;
      margin-top: 10px;
      border-radius: 0 4px 4px 0;
      font-size: 14px;
    }
    
    .demo-result p {
      margin: 5px 0;
    }
    
    .demo-result .value {
      font-weight: 600;
      color: var(--accent);
    }
    
    .theory-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .theory-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow: auto;
      padding: 25px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.2);
      position: relative;
    }
    
    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-light);
      background: none;
      border: none;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .close-btn:hover {
      background: #f5f5f5;
      color: #333;
    }
    
    .theory-content h2 {
      color: var(--accent);
      margin-top: 0;
    }
    
    .theory-point {
      margin-bottom: 15px;
      padding-left: 20px;
      position: relative;
    }
    
    .theory-point::before {
      content: 'â€¢';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-size: 20px;
    }

    /* ä»·æ ¼å˜åŒ–åŠ¨ç”» */
    .price-change {
      animation: pricePulse 1s ease-in-out;
      color: #e74c3c;
      font-weight: bold;
    }
    
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
    
    @media (max-width: 600px) {
      .roles {
        grid-template-columns: 1fr;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .controls button {
        width: 100%;
        margin-bottom: 8px;
      }
      
      .mode-select {
        flex-direction: column;
        align-items: center;
      }
      
      .mode-btn {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- æ¨¡å¼é€‰æ‹©ç•Œé¢ -->
    <div id="modeSelection" class="card">
      <h1>åŠ³åŠ¨ä»·å€¼è®ºæ•™å­¦æ¸¸æˆ</h1>
      <div class="subtitle">é€šè¿‡äº’åŠ¨ä½“éªŒç†è§£<b>åŠ³åŠ¨ä»·å€¼è®º</b>çš„æ ¸å¿ƒæ¦‚å¿µ</div>
      <img src="https://imgs.qiubiaoqing.com/qiubiaoqing/imgs/6065fe0aca5b9vhU.gif" alt="Description of the GIF">
      <div class="mode-select">
        <div class="mode-btn" onclick="selectMode('demo')">
          <h3>æ¼”ç¤ºæ¨¡å¼</h3>
          <p>å¿«é€Ÿä½“éªŒåŠ³åŠ¨ä»·å€¼è®ºçš„æ ¸å¿ƒæ¦‚å¿µ</p>
          <p class="muted">é€‚åˆæ•™å­¦æ¼”ç¤ºå’Œå¿«é€Ÿç†è§£</p>
        </div>
        
        <div class="mode-btn" onclick="selectMode('game')">
          <h3>æ¸¸æˆæ¨¡å¼</h3>
          <p>å®Œæ•´æ¸¸æˆä½“éªŒï¼ŒåŒ…å«è§’è‰²é€‰æ‹©å’Œç”Ÿäº§ç®¡ç†</p>
          <p class="muted">é€‚åˆæ·±å…¥å­¦ä¹ å’Œå®Œæ•´ä½“éªŒ</p>
        </div>
      </div>
      
      <div style="margin-top: 20px;">
        <button id="theoryBtn" class="ghost" onclick="showTheory()" >åŠ³åŠ¨ä»·å€¼è®ºç®€ä»‹</button>
      </div>
    </div>

    <!-- æ¸¸æˆæ¨¡å¼é€‰æ‹©ç•Œé¢ -->
    <div id="gameMode" class="card" style="display:none">
      <button class="return-btn" onclick="restartToMode()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        è¿”å›æ¨¡å¼é€‰æ‹©
      </button>
      
      <div style="display:flex; justify-content:center; align-items:center; flex-wrap:wrap">
        <div>
          <div class="label">é€‰æ‹©ä½ çš„è§’è‰²ï¼ˆæ¯ä¸ªè§’è‰²å¸¦ä¸åŒèµ·å§‹æ¡ä»¶ï¼‰</div>
          <div class="muted">è§’è‰²ä¼šå½±å“èµ·å§‹èµ„é‡‘ã€åˆå§‹é›‡å‘˜ä¸ç”Ÿäº§æ•ˆç‡ï¼Œç›´æ¥æ”¹å˜æ¸¸æˆä½“éªŒä¸ç»“å±€æ¦‚ç‡ã€‚</div>
        </div>
        <div>
          <button id="startBtn" class="small" disabled>å¼€å§‹æ¸¸æˆï¼ˆè¯·é€‰æ‹©è§’è‰²ï¼‰</button>
        </div>
      </div>

      <div class="roles" id="rolesContainer" aria-hidden="false">
        <!-- roles injected by JS -->
      </div>
    </div>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div id="gameArea" class="card" style="display:none">
      <button class="return-btn" onclick="restartToMode()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        è¿”å›æ¨¡å¼é€‰æ‹©
      </button>
      
      <div  class="topbar" style="margin-bottom:15px; justify-self: center;">
        <div class="label">æ¨¡å¼ï¼š<span id="modeName">æ¸¸æˆæ¨¡å¼</span></div>
        <div class="label">è§’è‰²ï¼š<span id="roleName">â€”</span></div>
        <div class="muted">ç¬¬ <span id="day">1</span> å¤© / å…± <span id="totalDays">30</span> å¤©</div>
      </div>
      <div style="text-align:right">
        <div>ğŸ’° <span id="money">0.0</span> å…ƒ</div>
        <div class="muted">åº“å­˜ï¼š<span id="totalInventory">0</span> ä»¶</div>
      </div>
    
      <div class="grid">
        <div>
          <!-- ç”Ÿäº§ç®¡ç†éƒ¨åˆ† -->
          <div class="section-title">ç”Ÿäº§ç®¡ç†</div>
          
          <div style="display:flex;gap:10px;align-items:center;margin-bottom:15px;flex-wrap:wrap">
            <label>ç”Ÿäº§å“ç§ï¼š</label>
            <select id="productSelect"></select>
            <button onclick="work()">åŠ³åŠ¨ï¼ˆç‚¹å‡»ï¼‰</button>
            <button class="ghost" id="autoBtn" onclick="autoWorkToggle()">å¼€å§‹è‡ªåŠ¨åŠ³åŠ¨</button>
          </div>

          <div class="muted">ç”Ÿäº§è¿›åº¦ï¼š<span id="progress">0</span> / <span id="laborNeed">5</span></div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="label">ç”Ÿäº§æ•ˆç‡</div>
              <div class="value" id="efficiency">â€”</div>
              <div class="muted">åŠ³åŠ¨å•ä½/ä»¶</div>
            </div>
            <div class="stat-card">
              <div class="label">é›‡å‘˜æ•°é‡</div>
              <div class="value" id="workers">0</div>
              <div class="muted">æ—¥å·¥èµ„æ”¯å‡º</div>
            </div>
            <div class="stat-card">
              <div class="label">åˆä½œç¤¾</div>
              <div class="value" id="isCoop">å¦</div>
              <div class="muted">æˆå‘˜å…±äº«æ”¶ç›Š</div>
            </div>
            <div class="stat-card">
              <div class="label">æ¯æ—¥ç”Ÿæ´»è´¹</div>
              <div class="value" id="dailyCost">20</div>
              <div class="muted">å…ƒ/å¤©</div>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:20px;flex-wrap:wrap">
            <button onclick="sellAll()">å»å¸‚åœºå–å‡ºå…¨éƒ¨</button>
            <button class="ghost" onclick="endDay()">ç»“æŸå½“å¤©ï¼ˆæ”¶ç»“ç®—ï¼‰</button>
            <button class="ghost" onclick="buyTool()">ä¹°å·¥å…·ï¼ˆ100å…ƒï¼‰</button>
            <button class="ghost" onclick="hireWorker()">é›‡äººï¼ˆ150å…ƒï¼‰</button>
            <button class="ghost" onclick="formCoop()">æˆç«‹åˆä½œç¤¾ï¼ˆæŠ˜æ‰£åæ˜¾ç¤ºï¼‰</button>
          </div>

          <div class="section-title">NPC å·¥äººï¼ˆç¤¾ä¼šï¼‰</div>
          <div id="npcList" class="muted"></div>

          <div class="section-title">æ¸¸æˆç»“å±€</div>
          <div id="ending" class="muted">æ¸¸æˆè¿›è¡Œä¸­â€¦</div>
          <div style="margin-top:10px">
            <button id="showbutton2" onclick="showTheory()">åŠ³åŠ¨ä»·å€¼è®ºç®€ä»‹</button>
            <button id="showbutton3" class="ghost" onclick="showStats()">æŸ¥çœ‹æ¸¸æˆç»Ÿè®¡</button>
          </div>
        </div>

        <div>
          <div class="section-title">å¸‚åœºä¿¡æ¯</div>
          <div class="stat"><div>ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´ï¼ˆå¹³å‡ï¼‰</div><div class="stat-value" id="avgTime">â€”</div></div>
          <div class="stat"><div>é¢åŒ…ä»·æ ¼ï¼ˆå…ƒ/ä»¶ï¼‰</div><div class="stat-value" id="price_bread">â€”</div></div>
          <div class="stat"><div>æœ¨æ¤…ä»·æ ¼ï¼ˆå…ƒ/ä»¶ï¼‰</div><div class="stat-value" id="price_chair">â€”</div></div>
          <div class="stat"><div>è¡£æœä»·æ ¼ï¼ˆå…ƒ/ä»¶ï¼‰</div><div class="stat-value" id="price_shirt">â€”</div></div>
          <div class="stat"><div>æ‰‹æœºä»·æ ¼ï¼ˆå…ƒ/ä»¶ï¼‰</div><div class="stat-value" id="price_phone">â€”</div></div>
          <div class="stat"><div>å½“æ—¥ä»·æ ¼æ³¢åŠ¨</div><div class="stat-value" id="vol">â€”</div></div>

          <div class="section-title">å•†å“æ˜ç»†</div>
          <div id="productArea"></div>

          <div class="section-title">æ¸¸æˆæ—¥å¿—</div>
          <div class="log" id="log"></div>
        </div>
      </div>
      <div class="footer">åŠ³åŠ¨ä»·å€¼è®ºæ•™å­¦æ¸¸æˆ</div>
    </div>

    <!-- æ¼”ç¤ºæ¨¡å¼åŒºåŸŸ -->
    <div id="demoArea" class="card" style="display:none;">
      <button class="return-btn" onclick="restartToMode()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        è¿”å›æ¨¡å¼é€‰æ‹©
      </button>

      <div class="topbar" style="margin-bottom:15px; justify-self: center;">
          <div class="label">æ¨¡å¼ï¼š<span id="demoModeName">æ¼”ç¤ºæ¨¡å¼</span></div>
          <div class="muted"><span id="demoacName">æ¼”ç¤ºæ¨¡å¼æ— éœ€è§’è‰²é€‰æ‹©</span></div>
      </div>

      <div class="grid">
        <div>
          <div class="section-title">æ ¸å¿ƒæ¦‚å¿µæ¼”ç¤º</div>
          <div class="explain">
            <h4>åŠ³åŠ¨ä»·å€¼è®ºæ ¸å¿ƒå·®å¼‚æ¼”ç¤º</h4>
            <p>é€šè¿‡ä»¥ä¸‹æŒ‰é’®ç›´æ¥ä½“éªŒåŠ³åŠ¨ä»·å€¼è®ºçš„æ ¸å¿ƒå·®å¼‚ï¼š</p>
            <p>â€¢ <strong>è‡ªå·±ç”Ÿäº§</strong>ï¼šæ¨¡æ‹Ÿç©å®¶ä¸ªäººåŠ³åŠ¨åœ¨ä¸€å¤©å†…çš„äº§å‡ºä¸æ”¶å…¥ï¼Œå…¨éƒ¨æ”¶ç›Šå½’ç©å®¶ã€‚</p>
            <p>â€¢ <strong>é›‡å·¥ç”Ÿäº§</strong>ï¼šæ¨¡æ‹Ÿä¸€åå·¥äººæ›¿ç©å®¶ç”Ÿäº§ï¼Œæ˜¾ç¤ºè¯¥å·¥äººå·¥èµ„ä¸ç©å®¶å æœ‰çš„å‰©ä½™ä»·å€¼ï¼ˆåˆ©æ¶¦ï¼‰ã€‚</p>
            <p class="highlight">æ¼”ç¤ºä¼˜åŒ–ï¼šç”Ÿäº§æ•°é‡ä¸ºéšæœºå€¼ï¼Œæ›´è´´è¿‘çœŸå®ç”Ÿäº§æƒ…å†µ</p>
          </div>

          <div style="display:flex;gap:8px;margin-top:15px;flex-wrap:wrap">
            <button onclick="demoSelfLabor()">è‡ªå·±ç”Ÿäº§ï¼ˆæ¼”ç¤ºï¼‰</button>
            <button onclick="demoHireLabor()">é›‡å·¥ç”Ÿäº§ï¼ˆæ¼”ç¤ºï¼š1åå·¥äººï¼‰</button>
          </div>
          
          <div id="demoResult"></div>
          
          <div class="section-title">ç†è®ºè§£é‡Š</div>
          <div class="explain">
            <h4>åŠ³åŠ¨ä»·å€¼è®ºæ ¸å¿ƒæ¦‚å¿µ</h4>
            <p><strong>è‡ªå·±åŠ³åŠ¨</strong>ï¼šåŠ³åŠ¨è€…è·å¾—å…¨éƒ¨åŠ³åŠ¨ä»·å€¼ï¼Œä½“ç°ä¸ªä½“åŠ³åŠ¨çš„å®Œæ•´å›æŠ¥ã€‚</p>
            <p><strong>é›‡ä½£åŠ³åŠ¨</strong>ï¼šå·¥äººåˆ›é€ çš„ä»·å€¼å¤§äºå…¶å·¥èµ„ï¼Œå·®é¢å½¢æˆå‰©ä½™ä»·å€¼ï¼ˆåˆ©æ¶¦ï¼‰ï¼Œä½“ç°èµ„æœ¬å¯¹åŠ³åŠ¨çš„å‰¥å‰Šã€‚</p>
            <p><strong>å‰©ä½™ä»·å€¼ç‡</strong>ï¼šå‰©ä½™ä»·å€¼ä¸å·¥èµ„çš„æ¯”ä¾‹ï¼Œè¡¡é‡å‰¥å‰Šç¨‹åº¦ã€‚</p>
          </div>
        </div>

        <div>
          <div class="section-title">æ¼”ç¤ºç»“æœ</div>
          <div id="demoResultContainer">
            <!-- æ¼”ç¤ºç»“æœå°†åŠ¨æ€æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
          </div>
          
          <div class="section-title">åŠ³åŠ¨ä»·å€¼è®ºç®€ä»‹</div>
          <div class="explain">
            <p><strong>åŠ³åŠ¨ä»·å€¼è®º</strong>æ˜¯é©¬å…‹æ€ä¸»ä¹‰æ”¿æ²»ç»æµå­¦çš„æ ¸å¿ƒç†è®ºä¹‹ä¸€ï¼Œå®ƒè§£é‡Šäº†å•†å“ä»·å€¼çš„æ¥æºå’Œèµ„æœ¬ç§¯ç´¯çš„æœ¬è´¨ã€‚</p>
            <p>æ ¸å¿ƒè§‚ç‚¹ï¼š</p>
            <ul>
              <li>å•†å“çš„ä»·å€¼å–å†³äºç”Ÿäº§å®ƒæ‰€æ¶ˆè€—çš„ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´</li>
              <li>å·¥äººåˆ›é€ çš„ä»·å€¼å¤§äºå…¶å·¥èµ„ï¼Œå·®é¢å½¢æˆå‰©ä½™ä»·å€¼ï¼ˆåˆ©æ¶¦ï¼‰</li>
              <li>èµ„æœ¬å®¶é€šè¿‡å æœ‰å‰©ä½™ä»·å€¼å®ç°èµ„æœ¬ç§¯ç´¯</li>
            </ul>
            <p>æœ¬æ¼”ç¤ºé€šè¿‡å¯¹æ¯”è‡ªå·±åŠ³åŠ¨å’Œé›‡ä½£åŠ³åŠ¨çš„æ”¶å…¥å·®å¼‚ï¼Œç›´è§‚å±•ç¤ºå‰©ä½™ä»·å€¼çš„äº§ç”Ÿè¿‡ç¨‹ã€‚</p>
          </div>
        
        </div>
      </div>
      <div class="footer">åŠ³åŠ¨ä»·å€¼è®ºæ•™å­¦æ¸¸æˆ Â· æ¼”ç¤ºæ¨¡å¼</div>
    </div>
    
    <!-- ç†è®ºä»‹ç»æ¨¡æ€æ¡† -->
    <div id="theoryModal" class="theory-modal">
      <div class="theory-content">
        <button id="closebutton" class="close-btn" onclick="closeTheory()">Ã—</button>
        <h2>åŠ³åŠ¨ä»·å€¼è®ºç®€ä»‹</h2>
        <p>åŠ³åŠ¨ä»·å€¼è®ºæ˜¯é©¬å…‹æ€ä¸»ä¹‰æ”¿æ²»ç»æµå­¦çš„æ ¸å¿ƒç†è®ºä¹‹ä¸€ï¼Œå®ƒè§£é‡Šäº†å•†å“ä»·å€¼çš„æ¥æºå’Œèµ„æœ¬ç§¯ç´¯çš„æœ¬è´¨ã€‚</p>
        
        <h3>æ ¸å¿ƒè§‚ç‚¹</h3>
        <div class="theory-point">
          <strong>ä»·å€¼ç”±åŠ³åŠ¨åˆ›é€ </strong>ï¼šå•†å“çš„ä»·å€¼å–å†³äºç”Ÿäº§å®ƒæ‰€æ¶ˆè€—çš„ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´
        </div>
        <div class="theory-point">
          <strong>å‰©ä½™ä»·å€¼ç†è®º</strong>ï¼šå·¥äººåˆ›é€ çš„ä»·å€¼å¤§äºå…¶å·¥èµ„ï¼Œå·®é¢å½¢æˆå‰©ä½™ä»·å€¼ï¼ˆåˆ©æ¶¦ï¼‰
        </div>
        <div class="theory-point">
          <strong>èµ„æœ¬ç§¯ç´¯</strong>ï¼šèµ„æœ¬å®¶é€šè¿‡å æœ‰å‰©ä½™ä»·å€¼å®ç°èµ„æœ¬ç§¯ç´¯
        </div>
        <div class="theory-point">
          <strong>ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´</strong>ï¼šåœ¨ç°æœ‰ç¤¾ä¼šæ­£å¸¸ç”Ÿäº§æ¡ä»¶ä¸‹ï¼Œç”Ÿäº§æŸç§å•†å“æ‰€éœ€çš„åŠ³åŠ¨æ—¶é—´
        </div>
        
        <h3>æ¸¸æˆä¸­çš„ä½“ç°</h3>
        <p>åœ¨æœ¬æ¸¸æˆä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½“éªŒåŠ³åŠ¨ä»·å€¼è®ºï¼š</p>
        <ul>
          <li>æ¯”è¾ƒè‡ªå·±åŠ³åŠ¨å’Œé›‡ä½£åŠ³åŠ¨çš„æ”¶å…¥å·®å¼‚</li>
          <li>è§‚å¯Ÿç”Ÿäº§æ•ˆç‡å¦‚ä½•å½±å“å•†å“ä»·å€¼</li>
          <li>ç†è§£å‰©ä½™ä»·å€¼å¦‚ä½•äº§ç”Ÿå’Œç§¯ç´¯</li>
          <li>ä½“éªŒä¸åŒç”Ÿäº§ç»„ç»‡æ–¹å¼ï¼ˆä¸ªä½“ã€é›‡ä½£ã€åˆä½œç¤¾ï¼‰çš„å·®å¼‚</li>
        </ul>
        
        <h3>å†å²èƒŒæ™¯</h3>
        <p>åŠ³åŠ¨ä»·å€¼è®ºç”±äºšå½“Â·æ–¯å¯†å’Œå¤§å«Â·æå˜‰å›¾ç­‰å¤å…¸ç»æµå­¦å®¶æå‡ºï¼Œåç”±å¡å°”Â·é©¬å…‹æ€åœ¨ã€Šèµ„æœ¬è®ºã€‹ä¸­ç³»ç»Ÿå‘å±•ï¼Œæˆä¸ºé©¬å…‹æ€ä¸»ä¹‰æ”¿æ²»ç»æµå­¦çš„åŸºçŸ³ã€‚</p>
      </div>
    </div>
    <div style="display: block;" id="viewArea2">
     <div class="modal" id="cModal">
    <div class="modal-content">
      <div class="container">
    <header>
      <h1>åŠ³åŠ¨ä»·å€¼è®ºç†è®ºæ¡†æ¶</h1>
      <p class="subtitle">ä»å¤å…¸ç»æµå­¦åˆ°é©¬å…‹æ€ä¸»ä¹‰æ”¿æ²»ç»æµå­¦çš„æ ¸å¿ƒç†è®ºä½“ç³»</p>
    </header>
    </div>
    <div class="content" id="viewArea" style="display:block">
      <!-- 1. èƒŒæ™¯ -->
      <div class="section">
        <h2 class="section-title">1. èƒŒæ™¯</h2>
        <div class="point">
          <div class="point-content">
            åŠ³åŠ¨ä»·å€¼è®ºæœ€åˆç”±å¤å…¸ç»æµå­¦å®¶æå‡ºï¼ˆäºšå½“Â·æ–¯å¯†ã€å¤§å«Â·æå˜‰å›¾ï¼‰ï¼Œåæ¥ç”±é©¬å…‹æ€ç»§æ‰¿å’Œå‘å±•ï¼Œå˜æˆæ­ç¤ºèµ„æœ¬ä¸»ä¹‰è¿ä½œæœºåˆ¶çš„ç†è®ºæ ¸å¿ƒã€‚
          </div>
        </div>
        
        <div class="theorist">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/8c/Adam_Smith_The_Muir_portrait_%28cropped_2%29.jpg" alt="äºšå½“Â·æ–¯å¯†">
          <div class="theorist-info">
            <div class="theorist-name">äºšå½“Â·æ–¯å¯† (1723-1790)</div>
            <div class="theorist-contribution">å¤å…¸ç»æµå­¦å¥ åŸºäººï¼Œé¦–æ¬¡ç³»ç»Ÿé˜è¿°åŠ³åŠ¨ä»·å€¼è®º</div>
          </div>
        </div>
        
        <div class="theorist">
          <img src="https://upload.wikimedia.org/wikipedia/commons/d/dc/Portrait_of_David_Ricardo_by_Thomas_Phillips.jpg" alt="å¤§å«Â·æå˜‰å›¾">
          <div class="theorist-info">
            <div class="theorist-name">å¤§å«Â·æå˜‰å›¾ (1772-1823)</div>
            <div class="theorist-contribution">å‘å±•åŠ³åŠ¨ä»·å€¼è®ºï¼Œå¼ºè°ƒå•†å“ä»·å€¼ç”±åŠ³åŠ¨é‡å†³å®š</div>
          </div>
        </div>
        
        <div class="theorist">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Karl_Marx_001.jpg/220px-Karl_Marx_001.jpg" alt="å¡å°”Â·é©¬å…‹æ€">
          <div class="theorist-info">
            <div class="theorist-name">å¡å°”Â·é©¬å…‹æ€ (1818-1883)</div>
            <div class="theorist-contribution">ç»§æ‰¿å¹¶å‘å±•åŠ³åŠ¨ä»·å€¼è®ºï¼Œåˆ›ç«‹å‰©ä½™ä»·å€¼ç†è®º</div>
          </div>
        </div>
      </div>
      
      <!-- 2. æ ¸å¿ƒè§‚ç‚¹ -->
      <div class="section">
        <h2 class="section-title">2. æ ¸å¿ƒè§‚ç‚¹</h2>
        
        <div class="point">
          <div class="point-title">ä»·å€¼çš„æœ¬è´¨</div>
          <div class="point-content">
            å•†å“çš„ä»·å€¼æ¥æºäºåŠ³åŠ¨ã€‚åŠ³åŠ¨æ˜¯åˆ›é€ ä»·å€¼çš„å”¯ä¸€æºæ³‰ã€‚
          </div>
        </div>
        
        <div class="point">
          <div class="point-title">ä»·å€¼é‡çš„å†³å®š</div>
          <div class="point-content">
            å•†å“çš„ä»·å€¼é‡å–å†³äºç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´ï¼Œå³åœ¨ç°æœ‰ç¤¾ä¼šæ­£å¸¸ç”Ÿäº§æ¡ä»¶ä¸‹ï¼Œç”Ÿäº§æŸç§å•†å“æ‰€éœ€çš„å¹³å‡åŠ³åŠ¨æ—¶é—´ã€‚
          </div>
        </div>
        
        <div class="point">
          <div class="point-title">ä½¿ç”¨ä»·å€¼ vs ä»·å€¼</div>
          <div class="highlight">
            <p><strong>ä½¿ç”¨ä»·å€¼</strong>ï¼šå•†å“æ»¡è¶³äººç±»éœ€è¦çš„å±æ€§ï¼ˆå¦‚é¢åŒ…èƒ½åƒã€è¡£æœèƒ½ç©¿ï¼‰ã€‚</p>
            <p><strong>ä»·å€¼</strong>ï¼šå•†å“ä¸­å‡ç»“çš„ä¸€èˆ¬äººç±»åŠ³åŠ¨ï¼ˆä¸æ˜¯æŸä¸ªå·¥äººè¾›è‹¦å¤šä¹…ï¼Œè€Œæ˜¯ç¤¾ä¼šå¹³å‡æ•ˆç‡ä¸‹æ‰€éœ€çš„åŠ³åŠ¨æ—¶é—´ï¼‰ã€‚</p>
          </div>
          <div class="point-content">
            å•†å“æ˜¯ä½¿ç”¨ä»·å€¼å’Œä»·å€¼çš„ç»Ÿä¸€ä½“ã€‚ä½¿ç”¨ä»·å€¼æ˜¯ä»·å€¼çš„ç‰©è´¨æ‰¿æ‹…è€…ã€‚
          </div>
        </div>
      </div>
      
      <!-- 3. å…³é”®æ¦‚å¿µ -->
      <div class="section">
        <h2 class="section-title">3. å…³é”®æ¦‚å¿µ</h2>
        
        <div class="concept-grid">
          <div class="concept-card">
            <div class="concept-title">ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´</div>
            <div class="point-content">
              åœ¨ç°æœ‰çš„ç¤¾ä¼šæ­£å¸¸ç”Ÿäº§æ¡ä»¶ä¸‹ã€å¹³å‡åŠ³åŠ¨ç†Ÿç»ƒç¨‹åº¦å’ŒåŠ³åŠ¨å¼ºåº¦ä¸‹ï¼Œç”Ÿäº§æŸç§å•†å“æ‰€éœ€è¦çš„åŠ³åŠ¨æ—¶é—´ã€‚
            </div>
          </div>
          
          <div class="concept-card">
            <div class="concept-title">å…·ä½“åŠ³åŠ¨ä¸æŠ½è±¡åŠ³åŠ¨</div>
            <div class="point-content">
              <p><strong>å…·ä½“åŠ³åŠ¨</strong> â†’ åˆ›é€ ä½¿ç”¨ä»·å€¼ï¼ˆé¢åŒ…å¸ˆåšé¢åŒ…ï¼Œè£ç¼åšè¡£æœï¼‰ã€‚</p>
              <p><strong>æŠ½è±¡åŠ³åŠ¨</strong> â†’ åˆ›é€ ä»·å€¼ï¼ˆä¸è®ºæ˜¯åšé¢åŒ…è¿˜æ˜¯åšè¡£æœï¼Œéƒ½å¯çœ‹æˆæ¶ˆè€—äººçš„ä½“åŠ›å’Œè„‘åŠ›ï¼‰ã€‚</p>
            </div>
          </div>
          
          <div class="concept-card">
            <div class="concept-title">å‰©ä½™ä»·å€¼</div>
            <div class="point-content">
              èµ„æœ¬å®¶æ”¯ä»˜å·¥äººå·¥èµ„ï¼ˆç›¸å½“äºåŠ³åŠ¨åŠ›çš„ä»·å€¼ï¼‰ï¼Œä½†å·¥äººåŠ³åŠ¨åˆ›é€ çš„ä»·å€¼å¤§äºå·¥èµ„ï¼Œå¤šå‡ºæ¥çš„éƒ¨åˆ†å°±æ˜¯èµ„æœ¬å®¶çš„åˆ©æ¶¦æ¥æºã€‚
            </div>
          </div>
        </div>
      </div>
      
      <!-- 4. é€»è¾‘é“¾æ¡ -->
      <div class="section">
        <h2 class="section-title">4. é€»è¾‘é“¾æ¡</h2>
        
        <div class="logic-chain">
          <div class="chain-step">
            <div class="step-number">1</div>
            <div class="point-title">å•†å“</div>
            <div class="point-content">èµ„æœ¬ä¸»ä¹‰ç”Ÿäº§çš„åŸºæœ¬å•ä½</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">2</div>
            <div class="point-title">ä»·å€¼ç”±åŠ³åŠ¨å†³å®š</div>
            <div class="point-content">åŠ³åŠ¨æ˜¯ä»·å€¼çš„å”¯ä¸€æºæ³‰</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">3</div>
            <div class="point-title">ä»·å€¼é‡ç”±ç¤¾ä¼šå¿…è¦åŠ³åŠ¨æ—¶é—´å†³å®š</div>
            <div class="point-content">ä»·å€¼é‡å–å†³äºç¤¾ä¼šå¹³å‡åŠ³åŠ¨æ—¶é—´</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">4</div>
            <div class="point-title">èµ„æœ¬å®¶è´­ä¹°åŠ³åŠ¨åŠ›</div>
            <div class="point-content">åŠ³åŠ¨åŠ›æˆä¸ºç‰¹æ®Šå•†å“</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">5</div>
            <div class="point-title">å·¥äººåˆ›é€ å¤§äºå·¥èµ„çš„ä»·å€¼</div>
            <div class="point-content">åŠ³åŠ¨åˆ›é€ çš„ä»·å€¼ > åŠ³åŠ¨åŠ›ä»·å€¼</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">6</div>
            <div class="point-title">äº§ç”Ÿå‰©ä½™ä»·å€¼</div>
            <div class="point-content">ä»·å€¼å¢å€¼éƒ¨åˆ†è¢«èµ„æœ¬å®¶å æœ‰</div>
          </div>
          
          <div class="chain-step">
            <div class="step-number">7</div>
            <div class="point-title">èµ„æœ¬ä¸»ä¹‰ç§¯ç´¯å’Œå‰¥å‰Šçš„æ ¹æº</div>
            <div class="point-content">å‰©ä½™ä»·å€¼è½¬åŒ–ä¸ºèµ„æœ¬ï¼Œå½¢æˆèµ„æœ¬ç§¯ç´¯</div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      <p>åŠ³åŠ¨ä»·å€¼è®ºç†è®ºæ¡†æ¶ | é©¬å…‹æ€ä¸»ä¹‰æ”¿æ²»ç»æµå­¦æ ¸å¿ƒç†è®º</p>
    </footer>
  </div>
      <div class="close-btn" id="closeModal">Ã—</div>
    </div>
  </div>
    
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // ----- Role definitions -----
  const ROLES = {
    small_farm: {
      key:'small_farm', 
      name:'å°å†œ / ä¸ªä½“ä½œåŠä¸»', 
      money:0, 
      laborDelta:0, 
      hired:0, 
      coopDiscount:0,
      desc: 'ä»é›¶å¼€å§‹ï¼Œä»¥ä¸ªäººåŠ³åŠ¨ç»´æŒç”Ÿè®¡ã€‚ä½“éªŒå¸‚åœºç«äº‰å‹åŠ›ï¼Œç†è§£ä¸ªä½“åŠ³åŠ¨è€…çš„å›°å¢ƒã€‚'
    },
    competitor: {
      key:'competitor', 
      name:'ç«äº‰è€… / å°ç§è¥æˆ·', 
      money:200, 
      laborDelta:-1, 
      hired:0, 
      coopDiscount:0,
      desc: 'æœ‰å°‘é‡å¯åŠ¨èµ„é‡‘ï¼Œæ•ˆç‡ç•¥ä¼˜ã€‚å¤„åœ¨æ¿€çƒˆç«äº‰ä¸­ï¼Œä½“éªŒèµ„æœ¬ç§¯ç´¯çš„æ—©æœŸé˜¶æ®µã€‚'
    },
    capitalist: {
      key:'capitalist', 
      name:'èµ„æœ¬å®¶å€™é€‰ / å°ä¼ä¸šä¸»', 
      money:500, 
      laborDelta:0, 
      hired:1, 
      coopDiscount:0,
      desc: 'æœ‰å¯åŠ¨èµ„æœ¬å¹¶å·²é›‡ä½£ä¸€äººï¼Œæ˜“äºæ‰©å¼ ä¸ç§¯ç´¯ã€‚ä½“éªŒå‰©ä½™ä»·å€¼çš„ç”Ÿäº§è¿‡ç¨‹ã€‚'
    },
    coop_initiator: {
      key:'coop_initiator', 
      name:'åˆä½œç¤¾å‘èµ·äºº', 
      money:300, 
      laborDelta:0, 
      hired:0, 
      coopDiscount:150,
      desc: 'å€¾å‘åˆä½œï¼Œæˆç«‹åˆä½œç¤¾æˆæœ¬æ›´ä½ï¼Œå°è¯•é›†ä½“åº”å¯¹å¸‚åœºé£é™©ï¼Œä½“éªŒå…±åŒåŠ³åŠ¨ä¸åˆ†é…ã€‚'
    }
  };

  // ----- Game parameters -----
  const TOTAL_DAYS = 30;
  let DAILY_LIFE_COST = 15;
  let COOP_COST_BASE = 400;
  const TOOL_COST = 100;
  const HIRE_COST = 150;
  const WORKER_DAILY_WAGE = 10;
  const AUTO_WORK_INTERVAL = 500;

  const PRODUCTS = [
    {id:'bread', name:'é¢åŒ…', labor:4, basePrice: 5},
    {id:'chair', name:'æœ¨æ¤…', labor:8, basePrice: 8},
    {id:'shirt', name:'è¡£æœ', labor:12, basePrice: 12},
    {id:'phone', name:'æ‰‹æœº', labor:20, basePrice: 25}
  ];

  let npcWorkers = [4,5,6]; // ç¤¾ä¼šå·¥äººæ•ˆç‡ï¼šæ¯ä»¶æ‰€éœ€åŠ³åŠ¨å•ä½

  // ----- state -----
  let state = {
    mode: null, // 'demo' or 'game'
    role: null,
    day:1,
    money:0,
    progress:0,
    selectedProduct: PRODUCTS[0].id,
    inventory: {bread:0, chair:0, shirt:0, phone:0},
    playerLabor: PRODUCTS[0].labor,
    autoWork:false,
    toolsUnlocked:false,
    hiredWorkers:0,
    coop:false,
    coopDiscount:0,
    log:[],
    stats: {
      totalProduced: 0,
      totalSold: 0,
      totalRevenue: 0,
      totalWagesPaid: 0,
      totalToolsBought: 0,
      workersHired: 0
    },
    prices: {
      bread: 5,
      chair: 8,
      shirt: 12,
      phone: 25
    },
    priceTimer: null // ä»·æ ¼å˜åŒ–å®šæ—¶å™¨
  };

  // ui refs
  const el = id => document.getElementById(id);
  const rolesContainer = el('rolesContainer');
  const startBtn = el('startBtn');
  const theoryBtn = el('theoryBtn');
  const theoryModal = el('theoryModal');
  const modeSelection = el('modeSelection');
  const gameMode = el('gameMode');
  const gameArea = el('gameArea');
  const demoArea = el('demoArea');
  const viewArea = el('viewArea');
  const viewArea2 = el('viewArea2');

  // æ¨¡å¼é€‰æ‹©
  function selectMode(mode) {
    state.mode = mode;
    modeSelection.style.display = 'none';
    
    if (mode === 'demo') {
      // æ˜¾ç¤ºæ¼”ç¤ºæ¨¡å¼
      demoArea.style.display = 'block';
      viewArea.style.display = 'none';
      viewArea2.style.display = 'none';
      el('demoModeName').innerText = 'æ¼”ç¤ºæ¨¡å¼';
    } else {
      // æ˜¾ç¤ºæ¸¸æˆæ¨¡å¼é€‰æ‹©
      gameMode.style.display = 'block';
      viewArea.style.display = 'none';
      viewArea2.style.display = 'none';
      renderRoles();
    }
  }
  
  // è¿”å›æ¨¡å¼é€‰æ‹©
  function restartToMode() {
    // é‡ç½®çŠ¶æ€
    state = { 
      mode: null,
      role: null,
      day:1,
      money:0,
      progress:0,
      selectedProduct:PRODUCTS[0].id, 
      inventory:{bread:0,chair:0,shirt:0,phone:0}, 
      playerLabor:PRODUCTS[0].labor, 
      autoWork:false, 
      toolsUnlocked:false, 
      hiredWorkers:0, 
      coop:false, 
      coopDiscount:0, 
      log:[],
      stats: {
        totalProduced: 0,
        totalSold: 0,
        totalRevenue: 0,
        totalWagesPaid: 0,
        totalToolsBought: 0,
        workersHired: 0
      },
      prices: {
        bread: 5,
        chair: 8,
        shirt: 12,
        phone: 25
      },
      priceTimer: null
    };
    
    // é‡ç½®UI
    gameArea.style.display = 'none';
    gameMode.style.display = 'none';
    demoArea.style.display = 'none';
    modeSelection.style.display = 'block';
    viewArea.style.display = 'block';
    viewArea2.style.display = 'block';

    // æ¸…é™¤æ—¥å¿—
    el('log').innerHTML = '';
    el('demoResult').innerHTML = '';
    
    // åœæ­¢æ‰€æœ‰å®šæ—¶å™¨
    stopPriceTimer();
    if (autoInterval) {
      clearInterval(autoInterval);
      autoInterval = null;
    }
  }
  window.restartToMode = restartToMode;

  // render roles on landing
  function renderRoles(){
    rolesContainer.innerHTML = '';
    Object.values(ROLES).forEach(r => {
      const div = document.createElement('div');
      div.className = 'role';
      div.dataset.role = r.key;
      div.innerHTML = `
        <div>
          <h3>${r.name}</h3>
          <p>${r.desc}</p>
        </div>
        <div class="meta">
          <span>èµ·å§‹èµ„é‡‘ï¼š<strong>${r.money}</strong> å…ƒ</span>
          <span>åˆå§‹é›‡å‘˜ï¼š<strong>${r.hired}</strong></span>
        </div>
      `;
      div.addEventListener('click', ()=>selectRoleCard(div, r.key));
      rolesContainer.appendChild(div);
    });
  }

  let selectedRoleKey = null;
  function selectRoleCard(elem, key){
    // visual
    document.querySelectorAll('.role').forEach(d=>d.classList.remove('selected'));
    elem.classList.add('selected');
    selectedRoleKey = key;
    startBtn.disabled = false;
  }

  // theory button
  function showTheory() {
    theoryModal.style.display = 'flex';
  }
  
  function closeTheory() {
    theoryModal.style.display = 'none';
  }
  
     gameArea.addEventListener('click', (e) => {
    if (e.target === showbutton2) {
      showTheory();
    }
  }); 

   gameArea.addEventListener('click', (e) => {
    if (e.target === showbutton3) {
      showStats();
    }
  });

  theoryModal.addEventListener('click', (e) => {
    if (e.target === closebutton) {
      closeTheory();
    }
  });

  // Close modal when clicking outside
  theoryModal.addEventListener('click', (e) => {
    if (e.target === theoryModal) {
      closeTheory();
    }
  });

  // Close modal with ESC key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && theoryModal.style.display === 'flex') {
      closeTheory();
    }
  });

  // start button
  startBtn.addEventListener('click', ()=>{
    if(!selectedRoleKey){ alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§’è‰²ã€‚'); return; }
    startGame(selectedRoleKey);
  });

  // ----- start game -----
  function startGame(roleKey){
    const r = ROLES[roleKey];
    state.role = roleKey;
    state.money = r.money;
    state.hiredWorkers = r.hired;
    state.coopDiscount = r.coopDiscount || 0;
    // set coop cost according to discount
    state.coopCost = Math.max(0, COOP_COST_BASE - state.coopDiscount);
    // player labor for selected product
    state.playerLabor = PRODUCTS.find(p=>p.id===state.selectedProduct).labor + (r.laborDelta || 0);
    // set UI role name and hide landing
    el('modeName').innerText = 'æ¸¸æˆæ¨¡å¼';
    el('roleName').innerText = r.name;
    gameMode.style.display = 'none';
    gameArea.style.display = 'block';
    el('totalDays').innerText = TOTAL_DAYS;
    log(`ä½ é€‰æ‹©äº†è§’è‰²ã€Œ${r.name}ã€ï¼Œèµ·å§‹èµ„é‡‘ ${r.money} å…ƒï¼Œåˆå§‹é›‡å‘˜ ${r.hired}ã€‚`);
    initGameUI();
    updateUI();
    
    // å¯åŠ¨ä»·æ ¼å®šæ—¶å™¨
    startPriceTimer();
  }

  // ----- game UI init -----
  function initGameUI(){
    // product select
    const sel = el('productSelect');
    sel.innerHTML = '';
    PRODUCTS.forEach(p=>{
      const opt = document.createElement('option'); 
      opt.value = p.id; 
      opt.textContent = `${p.name}ï¼ˆåŠ³åŠ¨ ${p.labor}ï¼‰`;
      sel.appendChild(opt);
    });
    sel.addEventListener('change', e=>{
      state.selectedProduct = e.target.value;
      const p = PRODUCTS.find(x=>x.id===state.selectedProduct);
      const role = ROLES[state.role];
      
      // é‡ç½®ç”Ÿäº§è¿›åº¦
      state.progress = 0;
      
      // æ›´æ–°æ‰€éœ€åŠ³åŠ¨å•ä½
      state.playerLabor = p.labor + (role.laborDelta || 0);
      
      // æ›´æ–°UIæ˜¾ç¤º
      el('laborNeed').innerText = state.playerLabor;
      el('progress').innerText = state.progress;
      
      // æ›´æ–°è¿›åº¦æ¡
      const progressPercent = (state.progress / state.playerLabor) * 100;
      el('progressFill').style.width = `${progressPercent}%`;
      
      log(`åˆ‡æ¢ç”Ÿäº§ï¼š${p.name}ï¼Œæ¯ä»¶éœ€åŠ³åŠ¨ ${state.playerLabor}`);
      updateUI();
    });
    renderProducts();
  }

  function renderProducts(){
    const area = el('productArea'); area.innerHTML='';
    PRODUCTS.forEach(p=>{
      const div = document.createElement('div'); div.className='product-row';
      div.innerHTML = `
        <div>
          <strong>${p.name}</strong>
          <div class="muted">åŠ³åŠ¨å•ä½ï¼š${p.labor}</div>
        </div>
        <div>åº“å­˜ï¼š<span id="inv_${p.id}">${state.inventory[p.id]}</span></div>
      `;
      area.appendChild(div);
    });
  }

  // logging
  function log(text, type='info'){
    const t = `[Day ${state.day}] ${text}`;
    state.log.unshift(`<div class="log-entry ${type}">${t}</div>`);
    
    // Keep log to 50 entries max
    if(state.log.length > 50) state.log.pop();
    
    el('log').innerHTML = state.log.join('');
  }

  function updateUI(){
    el('day').innerText = state.day;
    el('money').innerText = state.money.toFixed(1);
    el('progress').innerText = state.progress;
    el('laborNeed').innerText = state.playerLabor;
    
    // Update progress bar
    const progressPercent = (state.progress / state.playerLabor) * 100;
    el('progressFill').style.width = `${progressPercent}%`;
    
    el('totalInventory').innerText = Object.values(state.inventory).reduce((a,b)=>a+b,0);
    el('workers').innerText = state.hiredWorkers;
    el('isCoop').innerText = state.coop ? 'æ˜¯' : 'å¦';
    el('dailyCost').innerText = DAILY_LIFE_COST;
    el('efficiency').innerText = state.playerLabor;
    
    // NPC list
    const nl = el('npcList'); nl.innerHTML='';
    npcWorkers.forEach((n,i)=>{
      const d = document.createElement('div'); 
      d.className='muted'; 
      d.textContent = `NPC ${i+1}ï¼šæ•ˆç‡ ${n}ï¼ˆåŠ³åŠ¨å•ä½/ä»¶ï¼‰`;
      nl.appendChild(d);
    });
    
    const avg = computeAverageLabor();
    el('avgTime').innerText = avg.toFixed(2);
    
    // æ›´æ–°æ¯ç§å•†å“çš„ä»·æ ¼æ˜¾ç¤º
    PRODUCTS.forEach(p => {
      const priceEl = document.getElementById('price_' + p.id);
      if (priceEl) {
        priceEl.innerText = state.prices[p.id].toFixed(2);
      }
    });
    
    // Random volatility
    const volatility = (Math.random() * 1.5).toFixed(2);
    el('vol').innerText = `Â±${volatility} å…ƒ`;
    
    PRODUCTS.forEach(p=>{ 
      const invEl = document.getElementById('inv_'+p.id); 
      if(invEl) invEl.innerText = state.inventory[p.id]; 
    });
  }

  function computeAverageLabor(){
    let total = state.playerLabor;
    npcWorkers.forEach(x=> total += x);
    return total / (npcWorkers.length + 1);
  }

  // ======================
  // ä»·æ ¼å®šæ—¶å˜åŒ–ç³»ç»Ÿ
  // ======================
  
  // å¯åŠ¨ä»·æ ¼å®šæ—¶å™¨
  function startPriceTimer() {
    // æ¯10ç§’æ›´æ–°ä¸€æ¬¡ä»·æ ¼
    state.priceTimer = setInterval(changePrices, 10000);
    
    // ç«‹å³æ‰§è¡Œä¸€æ¬¡åˆå§‹å˜åŒ–
    changePrices();
  }
  
  // åœæ­¢ä»·æ ¼å®šæ—¶å™¨
  function stopPriceTimer() {
    if (state.priceTimer) {
      clearInterval(state.priceTimer);
      state.priceTimer = null;
    }
  }
  
  // ä»·æ ¼å˜åŒ–å‡½æ•°
function changePrices() {
    PRODUCTS.forEach(p => {
      // ç”Ÿæˆéšæœºå˜åŒ–å¹…åº¦ï¼ˆ-50% åˆ° +50%ï¼‰
      const changeRate = (Math.random() - 0.5) * 1.0; // -0.5 åˆ° +0.5
      
      // è®¡ç®—æ–°ä»·æ ¼
      const newPrice = state.prices[p.id] * (1 + changeRate);
      
      // ç¡®ä¿ä»·æ ¼ä¸ä½äºåŸºç¡€ä»·æ ¼çš„10%
      state.prices[p.id] = Math.max(p.basePrice * 0.5, newPrice);
      
      // æ›´æ–°UIå¹¶æ·»åŠ åŠ¨ç”»æ•ˆæœ
      const priceEl = document.getElementById('price_' + p.id);
      if (priceEl) {
        priceEl.innerText = state.prices[p.id].toFixed(2);
        
        // æ·»åŠ ä»·æ ¼å˜åŒ–åŠ¨ç”»
        priceEl.classList.add('price-change');
        setTimeout(() => {
          priceEl.classList.remove('price-change');
        }, 1000);
      }
    });
    
    // è®°å½•ä»·æ ¼å˜åŒ–
    log('å¸‚åœºä»·æ ¼å·²æ›´æ–°');
  }

  // actions
  function work(){
    if(!state.role){ alert('è¯·å…ˆåœ¨ä¸€çº§ç•Œé¢é€‰æ‹©è§’è‰²å¹¶å¼€å§‹æ¸¸æˆã€‚'); return; }
    state.progress += 1;
    if(state.progress >= state.playerLabor){
      state.progress = 0;
      state.inventory[state.selectedProduct] += 1;
      state.stats.totalProduced += 1;
      log(`ä½ å®Œæˆäº†ä¸€ä»¶ ${PRODUCTS.find(p=>p.id===state.selectedProduct).name}`, 'success');
    }
    updateUI();
  }

  let autoInterval = null;
  function autoWorkToggle(){
    if(!state.role){ alert('è¯·å…ˆé€‰æ‹©è§’è‰²å¹¶å¼€å§‹æ¸¸æˆã€‚'); return; }
    state.autoWork = !state.autoWork;
    const btn = el('autoBtn');
    if(state.autoWork){
      btn.innerText = 'åœæ­¢è‡ªåŠ¨åŠ³åŠ¨';
      btn.classList.add('warning');
      autoInterval = setInterval(()=>work(), AUTO_WORK_INTERVAL);
    } else {
      btn.innerText = 'å¼€å§‹è‡ªåŠ¨åŠ³åŠ¨';
      btn.classList.remove('warning');
      clearInterval(autoInterval); autoInterval = null;
    }
  }
  window.autoWorkToggle = autoWorkToggle;

   function sellAll(){
    if(!state.role){ alert('è¯·å…ˆé€‰æ‹©è§’è‰²å¹¶å¼€å§‹æ¸¸æˆã€‚'); return; }
    const totalItems = Object.values(state.inventory).reduce((a,b)=>a+b,0);
    if(totalItems === 0){ alert('æ²¡æœ‰åº“å­˜å¯ä»¥å–å‡ºï¼'); return; }
    
    let revenue = 0;
    PRODUCTS.forEach(p=>{ 
      // ä½¿ç”¨æ­£ç¡®çš„åº“å­˜é”®å
      const inventoryCount = state.inventory[p.id];
      revenue += inventoryCount * state.prices[p.id]; 
      state.stats.totalSold += inventoryCount;
      state.inventory[p.id] = 0; // é‡ç½®åº“å­˜
    });
    
    state.stats.totalRevenue += revenue;
    
    if(state.coop){
      const members = npcWorkers.length + 1;
      const share = revenue / members;
      state.money += share;
      log(`åˆä½œç¤¾å–å‡º ${totalItems} ä»¶ï¼Œä½ è·å¾—åˆ†çº¢ ${share.toFixed(1)} å…ƒï¼ˆæ€»æ”¶å…¥ ${revenue.toFixed(1)}ï¼‰`, 'info');
    } else {
      state.money += revenue;
      log(`ä½ å–å‡º ${totalItems} ä»¶ï¼Œè·å¾— ${revenue.toFixed(1)} å…ƒ`, 'success');
    }
    
    renderProducts(); 
    updateUI();
  }
  window.sellAll = sellAll;

  function endDay(){
    if(!state.role){ alert('è¯·å…ˆé€‰æ‹©è§’è‰²å¹¶å¼€å§‹æ¸¸æˆã€‚'); return; }
    const unitsPerDay = 40;
    let npcProduced = 0;
    npcWorkers.forEach(n => {
      const per = Math.max(0, Math.floor(unitsPerDay / n));
      state.inventory.bread += per; 
      npcProduced += per;
      state.stats.totalProduced += per;
    });
    
    let hiredProduced = 0;
    for(let i=0;i<state.hiredWorkers;i++){
      const avgNpc = npcWorkers.reduce((a,b)=>a+b,0)/npcWorkers.length;
      const per = Math.max(0, Math.floor(unitsPerDay / avgNpc));
      state.inventory.bread += per; 
      hiredProduced += per;
      state.stats.totalProduced += per;
    }
    
    log(`NPC ç”Ÿäº§ ${npcProduced} ä»¶ï¼Œé›‡å·¥ç”Ÿäº§ ${hiredProduced} ä»¶`, 'info');
    
    // æ–°å¢åŠŸèƒ½ï¼šä¸ºæ‰€æœ‰å•†å“éšæœºå¢åŠ åº“å­˜
    PRODUCTS.forEach(p => {
      // éšæœºå¢åŠ 1-5ä»¶åº“å­˜
      const randomIncrement = Math.floor(Math.random() * 5) + 1;
      state.inventory[p.id] += randomIncrement;
      state.stats.totalProduced += randomIncrement;
      log(`éšæœºå¢åŠ  ${p.name} ${randomIncrement} ä»¶`, 'info');
    });
    
    state.money -= DAILY_LIFE_COST;
    log(`æ”¯ä»˜ç”Ÿæ´»è´¹ ${DAILY_LIFE_COST} å…ƒ`, 'info');
    
    if(state.hiredWorkers>0){
      const wages = state.hiredWorkers * WORKER_DAILY_WAGE; 
      state.money -= wages;
      state.stats.totalWagesPaid += wages;
      log(`æ”¯ä»˜å·¥èµ„ ${wages} å…ƒ`, 'info');
    }
    
    // æŠ€æœ¯è¿›æ­¥
    npcWorkers = npcWorkers.map(n=>{ 
      const r=Math.random(); 
      if(r<0.15) return Math.max(1,n-1); 
      if(r>0.97) return n+1; 
      return n; 
    });
    
    if(state.toolsUnlocked){ 
      state.playerLabor = Math.max(1, state.playerLabor - 1); 
      log(`å·¥å…·æå‡æ•ˆç‡ï¼šç°åœ¨æ¯ä»¶åªéœ€ ${state.playerLabor} å•ä½åŠ³åŠ¨`, 'success');
    }
    
    if(state.day >= TOTAL_DAYS){ 
      concludeGame(); 
    } else { 
      state.day += 1; 
      updateUI(); 
    }
    
    if(state.money < -100){ 
      concludeGame(true); 
    }
  }
  window.endDay = endDay;

  function buyTool(){ 
    if(state.money < TOOL_COST){ alert('é’±ä¸å¤Ÿä¹°å·¥å…·ã€‚'); return; } 
    state.money -= TOOL_COST; 
    state.toolsUnlocked = true; 
    state.stats.totalToolsBought += 1;
    log('è´­ä¹°å·¥å…·ï¼šæ•ˆç‡æå‡ï¼ˆæ¯ä»¶åŠ³åŠ¨-1ï¼‰', 'success'); 
    updateUI(); 
  }
  window.buyTool = buyTool;

  function hireWorker(){ 
    if(state.money < HIRE_COST){ alert('é’±ä¸å¤Ÿé›‡äººã€‚'); return; } 
    state.money -= HIRE_COST; 
    state.hiredWorkers += 1; 
    state.stats.workersHired += 1;
    log('é›‡ä½£1åå·¥äºº', 'success'); 
    updateUI(); 
  }
  window.hireWorker = hireWorker;

  function formCoop(){ 
    if(state.coop){ alert('å·²æ˜¯åˆä½œç¤¾'); return; } 
    if(state.money < state.coopCost){ alert(`é’±ä¸å¤Ÿæˆç«‹åˆä½œç¤¾ï¼ˆéœ€è¦ ${state.coopCost} å…ƒï¼‰`); return; } 
    state.money -= state.coopCost; 
    state.coop = true; 
    log('æˆç«‹åˆä½œç¤¾ï¼šä»¥åæ”¶ç›ŠæŒ‰æˆå‘˜åˆ†é…', 'success'); 
    updateUI(); 
  }
  window.formCoop = formCoop;

  // --- æ¼”ç¤ºåŠŸèƒ½ï¼šç”Ÿäº§æ•°é‡ä¸ºéšæœºå€¼ ---
  function demoSelfLabor(){
    // éšæœºç”Ÿæˆç”Ÿäº§æ•°é‡
    const unitsProduced = Math.floor(Math.random() * 200) + 1; 
    const price = Math.random() * 50 + 1; // éšæœºä»·æ ¼
    const revenue = unitsProduced * price;
    
    const resultDiv = el('demoResult');
    resultDiv.innerHTML = `
      <div class="demo-result">
        <p>è‡ªå·±ç”Ÿäº§æ¼”ç¤ºç»“æœï¼š</p>
        <p>â€¢ ç”Ÿäº§æ•°é‡: <span class="value">${unitsProduced}</span> ä»¶ï¼ˆéšæœºï¼‰</p>
        <p>â€¢ å¸‚åœºä»·æ ¼: <span class="value">${price.toFixed(2)}</span> å…ƒ/ä»¶</p>
        <p>â€¢ æ€»æ”¶å…¥: <span class="value">${revenue.toFixed(1)}</span> å…ƒ</p>
        <p>â€¢ å…¨éƒ¨æ”¶ç›Šå½’åŠ³åŠ¨è€…æ‰€æœ‰</p>
      </div>
    `;
  }

  function demoHireLabor(){
    // éšæœºç”Ÿæˆç”Ÿäº§æ•°é‡
    const unitsProduced = Math.floor(Math.random() * 200) + 1;
    const price = Math.random() * 30 + 10; // éšæœºä»·æ ¼
    const totalValue = unitsProduced * price;
    const wage = Math.random() * 100 + 100; // éšæœºå·¥èµ„
    const surplus = totalValue - wage;
    
    const resultDiv = el('demoResult');
    resultDiv.innerHTML = `
      <div class="demo-result">
        <p>é›‡å·¥ç”Ÿäº§æ¼”ç¤ºç»“æœï¼š</p>
        <p>â€¢ å·¥äººç”Ÿäº§: <span class="value">${unitsProduced}</span> ä»¶ï¼ˆéšæœºï¼‰</p>
        <p>â€¢ å•†å“æ€»ä»·å€¼: <span class="value">${totalValue.toFixed(1)}</span> å…ƒ</p>
        <p>â€¢ æ”¯ä»˜å·¥èµ„: <span class="value">${wage.toFixed(1)}</span> å…ƒ</p>
        <p>â€¢ å‰©ä½™ä»·å€¼(åˆ©æ¶¦): <span class="value">${surplus.toFixed(1)}</span> å…ƒ</p>
        <p>â€¢ å‰©ä½™ä»·å€¼ç‡: <span class="value">${(surplus/wage*100).toFixed(1)}%</span></p>
      </div>
    `;
  }

  window.demoSelfLabor = demoSelfLabor;
  window.demoHireLabor = demoHireLabor;

  function concludeGame(broken=false){
    const avgLabor = computeAverageLabor(); 
    const playerLabor = state.playerLabor;
    
    let text = '';
    let colorClass = '';
    
    if(!broken && playerLabor >= avgLabor * 1.20 && state.money < 50){
      text = `ç»“å±€ï¼šå·å…¥å¸‚åœºç«äº‰ï¼ˆè¢«æ·˜æ±°ï¼‰ã€‚ä½  ${playerLabor.toFixed(1)} vs ç¤¾ä¼šå¹³å‡ ${avgLabor.toFixed(1)}ï¼Œèµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`;
      colorClass = 'danger';
    }
    else if(broken || state.money < -50){ 
      text = `ç»“å±€ï¼šç ´äº§æ¸…ç®—ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'danger';
    }
    else if(state.coop && state.money >= 300){ 
      text = `ç»“å±€ï¼šæˆåŠŸçš„åˆä½œç¤¾ï¼ˆå…±èµ¢ï¼‰ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'success';
    }
    else if(state.coop){ 
      text = `ç»“å±€ï¼šåˆä½œç¤¾ï¼ˆå‹‰å¼ºç»´æŒï¼‰ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'warning';
    }
    else if(state.hiredWorkers > 3 && state.money >= 1000){ 
      text = `ç»“å±€ï¼šèµ„æœ¬å®¶ï¼ˆç§¯ç´¯æˆåŠŸï¼‰ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'success';
    }
    else if(state.hiredWorkers > 0 && state.money >= 500){ 
      text = `ç»“å±€ï¼šå°ä¼ä¸šä¸»ï¼ˆç¨³å®šç»è¥ï¼‰ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'success';
    }
    else if(state.money >= 300){ 
      text = `ç»“å±€ï¼šä¸ªä½“ç»è¥è€…ï¼ˆå°æœ‰ç§¯è“„ï¼‰ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'success';
    }
    else { 
      text = `ç»“å±€ï¼šå‹‰å¼ºç»´æŒç”Ÿè®¡ã€‚èµ„é‡‘ ${state.money.toFixed(1)} å…ƒã€‚`; 
      colorClass = 'warning';
    }
    
    el('ending').innerHTML = `<div class="${colorClass}">${text}</div>`;
    log(`æ¸¸æˆç»“æŸï¼š${text}`, colorClass);
    disableAll();
    
    // 5ç§’åè‡ªåŠ¨è¿”å›ä¸»ç•Œé¢
    setTimeout(() => {
      refreshPage();
      // æ·»åŠ æ¸¸æˆç»“æŸæç¤º
      alert(`æ¸¸æˆç»“æŸï¼š${text}\n\nå·²è‡ªåŠ¨è¿”å›ä¸»ç•Œé¢ï¼Œæ‚¨å¯ä»¥é‡æ–°å¼€å§‹æ¸¸æˆã€‚`);
    }, 2000);
  }

  function refreshPage() {
      // ä½¿ç”¨location.reload()æ–¹æ³•åˆ·æ–°é¡µé¢
      location.reload();
    }

  function disableAll(){
    document.querySelectorAll('button').forEach(b=>b.disabled=true);
    document.querySelectorAll('select').forEach(s=>s.disabled=true);
    if(autoInterval) {
      clearInterval(autoInterval);
      autoInterval = null;
      el('autoBtn').innerText = 'å¼€å§‹è‡ªåŠ¨åŠ³åŠ¨';
      el('autoBtn').classList.remove('warning');
    }
    
    // åœæ­¢ä»·æ ¼å®šæ—¶å™¨
    stopPriceTimer();
  }

function showStats() {
    const stats = state.stats;
    alert(`æ¸¸æˆç»Ÿè®¡ï¼š
æ€»ç”Ÿäº§æ•°é‡: ${stats.totalProduced} ä»¶
æ€»é”€å”®æ•°é‡: ${stats.totalSold} ä»¶
æ€»æ”¶å…¥: ${stats.totalRevenue.toFixed(1)} å…ƒ
æ€»å·¥èµ„æ”¯å‡º: ${stats.totalWagesPaid.toFixed(1)} å…ƒ
å·¥å…·è´­ä¹°æ¬¡æ•°: ${stats.totalToolsBought}
å·¥äººé›‡ä½£æ¬¡æ•°: ${stats.workersHired}`);
  }

  // initialize
  renderRoles();
  
  // ä¿®å¤é—®é¢˜ï¼šæ¨¡å¼é€‰æ‹©æŒ‰é’®ç»‘å®š
  const demoModeBtn = document.querySelector('.mode-btn:nth-child(1)');
  const gameModeBtn = document.querySelector('.mode-btn:nth-child(2)');
  
  if(demoModeBtn) {
    demoModeBtn.addEventListener('click', () => selectMode('demo'));
  }
  
  if(gameModeBtn) {
    gameModeBtn.addEventListener('click', () => selectMode('game'));
  }
  
  // ä¿®å¤é—®é¢˜ï¼šç†è®ºç®€ä»‹æŒ‰é’®ç»‘å®š
  const theoryButton = document.getElementById('theoryBtn');
  if(theoryButton) {
    theoryButton.addEventListener('click', showTheory);
  }
  
  // ç¡®ä¿workå‡½æ•°å…¨å±€å¯è®¿é—®
  window.work = work;
}); // DOMContentLoaded end


</script>
</body>
</html>